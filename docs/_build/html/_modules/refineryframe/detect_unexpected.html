<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>refineryframe.detect_unexpected &mdash; refineryframe package  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            refineryframe package
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">refineryframe</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">refineryframe package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">refineryframe.detect_unexpected</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for refineryframe.detect_unexpected</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">detect_unexpected.py - Data Quality Checking Module</span>

<span class="sd">This module contains functions to detect unexpected values in a pandas DataFrame,</span>
<span class="sd">helping to identify potential data quality issues. The functions cover various aspects</span>
<span class="sd">of data validation, including checking for missing values, unexpected data types, duplicates,</span>
<span class="sd">incorrect date formats, out-of-range numeric values, and date values outside specified date ranges.</span>

<span class="sd">Functions:</span>

<span class="sd">1. check_missing_types(dataframe, MISSING_TYPES, independent=True, logger=logging):</span>

<span class="sd">    Check for instances of missing types in each column of the DataFrame.</span>
<span class="sd">    Logs warning messages if any missing values are found.</span>

<span class="sd">2. check_missing_values(dataframe, logger=logging):</span>

<span class="sd">    Count the number of NaN, None, and NaT values in each column of the DataFrame.</span>
<span class="sd">    Logs warning messages if any missing values are found.</span>

<span class="sd">3. check_inf_values(dataframe, independent=True, logger=logging):</span>

<span class="sd">    Count the infinite (INF) values in each numeric column of the DataFrame.</span>
<span class="sd">    Logs warning messages if any INF values are found.</span>

<span class="sd">4. check_date_format(dataframe, expected_date_format=&#39;%Y-%m-%d&#39;, independent=True, logger=logging):</span>

<span class="sd">    Check if the values in datetime columns of the DataFrame have the expected format.</span>
<span class="sd">    Logs warning messages for columns with non-date values or unexpected date formats.</span>

<span class="sd">5. check_duplicates(dataframe, subset=None, independent=True, logger=logging):</span>

<span class="sd">    Check for duplicates in the DataFrame.</span>
<span class="sd">    Logs warning messages if any duplicates are found based on specified columns.</span>

<span class="sd">6. check_col_names_types(dataframe, types_dict_str, independent=True, logger=logging):</span>

<span class="sd">    Check if the DataFrame has the same column names as specified in the dictionary</span>
<span class="sd">    and if those columns have the expected data types as values in the dictionary.</span>
<span class="sd">    Logs warning messages for columns with incorrect names or data types.</span>

<span class="sd">7. check_numeric_range(dataframe, numeric_cols=None, lower_bound=-float(&#39;inf&#39;), upper_bound=float(&#39;inf&#39;),\</span>
<span class="sd">    independent=True, ignore_values=[], logger=logging):</span>

<span class="sd">    Check if numeric values in the DataFrame are within specified ranges.</span>
<span class="sd">    Logs warning messages for numeric values outside the specified range.</span>

<span class="sd">8. check_date_range(dataframe, earliest_date=&#39;1900-01-01&#39;, latest_date=&#39;2100-12-31&#39;,\</span>
<span class="sd">    independent=True, ignore_dates=[], logger=logging):</span>

<span class="sd">    Check if date values in the DataFrame are within specified date ranges.</span>
<span class="sd">    Logs warning messages for date values outside the specified range.</span>

<span class="sd">9. detect_unexpected_values(dataframe, MISSING_TYPES, unexpected_exceptions,\</span>
<span class="sd">                            unexpected_exceptions_error, unexpected_conditions, thresholds,\</span>
<span class="sd">                            ids_for_dedup, TEST_DUV_FLAGS_PATH, types_dict_str,\</span>
<span class="sd">                            expected_date_format, earliest_date, latest_date,\</span>
<span class="sd">                            numeric_lower_bound, numeric_upper_bound, print_score,\</span>
<span class="sd">                            logger):</span>

<span class="sd">    Detect unexpected values in a pandas DataFrame by running a series of data quality checks.</span>
<span class="sd">    The function returns the &quot;duv_score,&quot; representing the percentage of passed tests.</span>

<span class="sd">Note:</span>
<span class="sd">- Some functions use the `logger` parameter for logging warning messages instead of printing.</span>
<span class="sd">- Users can specify exceptions for certain checks using the `unexpected_exceptions` dictionary.</span>
<span class="sd">- Users can define additional conditions to check for unexpected values using the `unexpected_conditions` dictionary.</span>
<span class="sd">- The `thresholds` parameter in the `detect_unexpected_values` function allows users to set threshold scores for different checks.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">refineryframe.other</span> <span class="kn">import</span> <span class="n">get_type_dict</span><span class="p">,</span> <span class="n">treat_unexpected_cond</span>

<div class="viewcode-block" id="check_missing_types"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_missing_types">[docs]</a><span class="k">def</span> <span class="nf">check_missing_types</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                        <span class="n">MISSING_TYPES</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                        <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;numeric_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                             <span class="s1">&#39;date_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                             <span class="s1">&#39;cat_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                        <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The function takes a DataFrame and a dictionary of missing types as input, and</span>
<span class="sd">    searches for any instances of these missing types in each column of the DataFrame.</span>
<span class="sd">    If any instances are found, a warning message is logged containing the column name,</span>
<span class="sd">    the missing value, and the count of missing values found.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">                The DataFrame to search for missing values.</span>
<span class="sd">    MISSING_TYPES : dict</span>
<span class="sd">        A dictionary of missing types to search for. The keys represent the missing type</span>
<span class="sd">        and the values are the corresponding values to search for.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        The function does not return anything, but logs a warning message for each</span>
<span class="sd">        instance of a missing value found in the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking for presence of missing types&quot;</span><span class="p">)</span>

        <span class="n">DATE_MISS_TYPES_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">NUMERIC_MISS_TYPES_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">CHARACTER_MISS_TYPES_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">DATE_MISS_TYPES_SCORE_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
        <span class="n">NUMERIC_MISS_TYPES_SCORE_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
        <span class="n">CHARACTER_MISS_TYPES_SCORE_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>

        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dtype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MISSING_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="c1">#if v in dataframe[col].values:</span>
                        <span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">])</span>
                        <span class="n">numeric_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">) : </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">numeric_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                        <span class="n">NUMERIC_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">NUMERIC_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">numeric_score</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">NUMERIC_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">NUMERIC_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dtype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;datetime64&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MISSING_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                            <span class="n">date_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">) : </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">date_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                            <span class="n">DATE_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                            <span class="n">DATE_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">date_score</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">DATE_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">DATE_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">DATE_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">DATE_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">dtype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MISSING_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">v</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                        <span class="n">cat_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">) : </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">cat_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                        <span class="n">CHARACTER_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">CHARACTER_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">cat_score</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">CHARACTER_MISS_TYPES_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">CHARACTER_MISS_TYPES_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">numeric_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">NUMERIC_MISS_TYPES_SCORE_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">date_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">DATE_MISS_TYPES_SCORE_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cat_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">CHARACTER_MISS_TYPES_SCORE_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">numeric_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;numeric_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Numeric score was lower then expected: </span><span class="si">{</span><span class="n">numeric_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;numeric_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">date_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;date_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date score was lower then expected: </span><span class="si">{</span><span class="n">date_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;date_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cat_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cat_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character score was lower then expected: </span><span class="si">{</span><span class="n">cat_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cat_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while checking missing types!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">DATE_MISS_TYPES_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">NUMERIC_MISS_TYPES_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">CHARACTER_MISS_TYPES_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

        <span class="n">numeric_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">date_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cat_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>

        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="nb">all</span><span class="p">(</span><span class="n">DATE_MISS_TYPES_TEST_LIST</span><span class="p">),</span>
                    <span class="nb">all</span><span class="p">(</span><span class="n">NUMERIC_MISS_TYPES_TEST_LIST</span><span class="p">),</span>
                    <span class="nb">all</span><span class="p">(</span><span class="n">CHARACTER_MISS_TYPES_TEST_LIST</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cmt_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;numeric_score&#39;</span> <span class="p">:</span> <span class="n">numeric_score</span><span class="p">,</span>
                                                <span class="s1">&#39;date_score&#39;</span> <span class="p">:</span> <span class="n">date_score</span><span class="p">,</span>
                                                <span class="s1">&#39;cat_score&#39;</span> <span class="p">:</span> <span class="n">cat_score</span><span class="p">}},</span>
                       <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">DATE_MISS_TYPES_TEST_LIST</span><span class="p">),</span>
                                  <span class="nb">all</span><span class="p">(</span><span class="n">NUMERIC_MISS_TYPES_TEST_LIST</span><span class="p">),</span>
                                  <span class="nb">all</span><span class="p">(</span><span class="n">CHARACTER_MISS_TYPES_TEST_LIST</span><span class="p">))}</span>

        <span class="k">return</span> <span class="n">output_dict</span></div>



<div class="viewcode-block" id="check_missing_values"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_missing_values">[docs]</a><span class="k">def</span> <span class="nf">check_missing_values</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                         <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;missing_values_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                        <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Count the number of NaN, None, and NaT values in each column of a pandas DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">                The DataFrame to count missing values in.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking for presence of missing values&quot;</span><span class="p">)</span>

        <span class="n">MISSING_COUNT_TEST</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">MISSING_COUNT_SCORE_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>

        <span class="c1"># Define the missing values to check for</span>
        <span class="n">missing_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">]</span>

        <span class="c1"># Count the number of missing values in each column</span>
        <span class="n">missing_counts</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">|</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">missing_values</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">missing_counts_filtered</span> <span class="o">=</span> <span class="n">missing_counts</span><span class="p">[</span><span class="n">missing_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_counts_filtered</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">missing_counts_filtered</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing_counts_filtered</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>

                <span class="n">count_score</span> <span class="o">=</span> <span class="n">count</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: (NA) : </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">count_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                <span class="n">MISSING_COUNT_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">count_score</span><span class="p">)</span>



            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MISSING_COUNT_TEST</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">missing_values_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">MISSING_COUNT_SCORE_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_values_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;missing_values_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing values score was lower then expected: </span><span class="si">{</span><span class="n">missing_values_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;missing_values_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while counting missing values!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">missing_values_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">MISSING_COUNT_TEST</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cmv_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;missing_values_score&#39;</span> <span class="p">:</span> <span class="n">missing_values_score</span><span class="p">}},</span>
                   <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">MISSING_COUNT_TEST</span><span class="p">]}</span>

    <span class="k">return</span> <span class="n">output_dict</span></div>



<div class="viewcode-block" id="check_inf_values"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_inf_values">[docs]</a><span class="k">def</span> <span class="nf">check_inf_values</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                     <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inf_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                     <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Count the inf values in each column of a pandas DataFrame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">                The DataFrame to count inf values in.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking for presense of inf values in numeric colums&quot;</span><span class="p">)</span>

        <span class="n">NUM_INF_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">NUM_INF_SCORE_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>

        <span class="c1"># Count the number of INF values</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
                <span class="n">col_missing_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                                                              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="kc">False</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col_missing_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">col_missing_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">inf_score</span> <span class="o">=</span> <span class="n">col_missing_counts</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: (INF) : </span><span class="si">{</span><span class="n">col_missing_counts</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">inf_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                <span class="n">NUM_INF_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">NUM_INF_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">inf_score</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">NUM_INF_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">NUM_INF_SCORE_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">inf_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">NUM_INF_SCORE_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inf_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;inf_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inf score was lower then expected: </span><span class="si">{</span><span class="n">inf_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;inf_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while checking inf values!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">NUM_INF_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">inf_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;inf_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;inf_score&#39;</span> <span class="p">:</span> <span class="n">inf_score</span><span class="p">}},</span>
                   <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">all</span><span class="p">(</span><span class="n">NUM_INF_TEST_LIST</span><span class="p">)]}</span>

    <span class="k">return</span> <span class="n">output_dict</span></div>

<div class="viewcode-block" id="check_date_format"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_date_format">[docs]</a><span class="k">def</span> <span class="nf">check_date_format</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                      <span class="n">expected_date_format</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                      <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date_format_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                      <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the values in the datetime columns of the input dataframe</span>
<span class="sd">    have the expected &#39;YYYY-MM-DD&#39; format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe: pandas.DataFrame</span>
<span class="sd">        The dataframe to be checked for date format.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking propper date format&quot;</span><span class="p">)</span>

        <span class="n">DATE_FORMAT_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">):</span>
                <span class="n">date_vals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
                <span class="n">non_date_mask</span> <span class="o">=</span> <span class="n">date_vals</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">non_date_mask</span><span class="p">):</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> has non-date values or unexpected format.&quot;</span><span class="p">)</span>

                    <span class="n">DATE_FORMAT_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">DATE_FORMAT_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">date_format_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="nb">sum</span><span class="p">(</span><span class="n">DATE_FORMAT_TEST_LIST</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">DATE_FORMAT_TEST_LIST</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">independent</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">DATE_FORMAT_TEST_LIST</span><span class="p">):</span>
                <span class="n">DATE_FORMAT_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="nb">all</span><span class="p">(</span><span class="n">DATE_FORMAT_TEST_LIST</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">date_format_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;date_format_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date format score was lower then expected: </span><span class="si">{</span><span class="n">date_format_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;date_format_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occurred while checking date format!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">DATE_FORMAT_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">date_format_score</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cdf_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;date_format_score&#39;</span> <span class="p">:</span> <span class="n">date_format_score</span><span class="p">}},</span>
                                             <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">all</span><span class="p">(</span><span class="n">DATE_FORMAT_TEST_LIST</span><span class="p">)]}</span>

    <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">DATE_FORMAT_TEST_LIST</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output_dict</span></div>


<div class="viewcode-block" id="check_duplicates"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_duplicates">[docs]</a><span class="k">def</span> <span class="nf">check_duplicates</span><span class="p">(</span><span class="n">dataframe</span>  <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                     <span class="n">subset</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;row_dup_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                          <span class="s1">&#39;key_dup_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                    <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check for duplicates in a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">        The DataFrame to check for duplicates.</span>
<span class="sd">    subset : list of str, optional</span>
<span class="sd">        A list of column names to consider when identifying duplicates.</span>
<span class="sd">        If not specified, all columnsare used to identify duplicates.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    int</span>
<span class="sd">        The number of duplicates found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking for duplicates&quot;</span><span class="p">)</span>

        <span class="n">ROW_DUPLICATES</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="n">n_duplicates</span> <span class="o">=</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">subset</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">):</span>
            <span class="n">subset_duplicates</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
            <span class="n">n_subset_duplicates</span> <span class="o">=</span> <span class="n">subset_duplicates</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">n_subset_duplicates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">key_dup_score</span> <span class="o">=</span> <span class="n">n_subset_duplicates</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">n_subset_duplicates</span><span class="si">}</span><span class="s2"> duplicate keys : </span><span class="si">{</span><span class="n">key_dup_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                <span class="n">n_duplicates</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">n_true_dup</span> <span class="o">=</span> <span class="n">n_subset_duplicates</span> <span class="o">-</span> <span class="n">n_duplicates</span>

                <span class="k">if</span> <span class="n">n_true_dup</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="n">row_dup_score</span> <span class="o">=</span> <span class="n">n_true_dup</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;** Deduplication keys do not form the super key!&quot;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">n_true_dup</span><span class="si">}</span><span class="s2"> duplicates beyond keys : </span><span class="si">{</span><span class="n">row_dup_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

                    <span class="n">KEY_DUPLICATES</span> <span class="o">=</span> <span class="kc">False</span>


                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ROW_DUPLICATES</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">KEY_DUPLICATES</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">row_dup_score</span> <span class="o">=</span> <span class="n">n_subset_duplicates</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                    <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with row duplicates before proceesing any further!&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ROW_DUPLICATES</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">KEY_DUPLICATES</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">row_dup_score</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">key_dup_score</span> <span class="o">=</span> <span class="mi">0</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_duplicates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">KEY_DUPLICATES</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">row_dup_score</span> <span class="o">=</span> <span class="n">n_duplicates</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>
                <span class="n">key_dup_score</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">n_duplicates</span><span class="si">}</span><span class="s2"> duplicates : </span><span class="si">{</span><span class="n">row_dup_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with row duplicates before proceesing any further!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ROW_DUPLICATES</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">KEY_DUPLICATES</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">row_dup_score</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">key_dup_score</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">row_dup_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">row_dup_score</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">key_dup_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">key_dup_score</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">row_dup_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;row_dup_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row duplicates score was lower then expected: </span><span class="si">{</span><span class="n">row_dup_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;row_dup_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key_dup_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;key_dup_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key duplicates score was lower then expected: </span><span class="si">{</span><span class="n">key_dup_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;key_dup_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>



    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while checking duplicates!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">row_dup_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">key_dup_score</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dup_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;row_dup_score&#39;</span> <span class="p">:</span> <span class="n">row_dup_score</span><span class="p">,</span>
                                             <span class="s1">&#39;key_dup_score&#39;</span> <span class="p">:</span> <span class="n">key_dup_score</span><span class="p">}},</span>
                                             <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ROW_DUPLICATES</span><span class="p">,</span> <span class="n">KEY_DUPLICATES</span><span class="p">]}</span>


    <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">ROW_DUPLICATES</span><span class="p">,</span> <span class="n">KEY_DUPLICATES</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output_dict</span></div>



<div class="viewcode-block" id="check_col_names_types"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_col_names_types">[docs]</a><span class="k">def</span> <span class="nf">check_col_names_types</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                          <span class="n">types_dict_str</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                          <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;missing_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                               <span class="s1">&#39;incorrect_dtypes_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                          <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a given dataframe has the same column names as keys in a given dictionary</span>
<span class="sd">    and those columns have the same types as items in the dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">    - dataframe: pandas DataFrame</span>
<span class="sd">    - column_dict: dictionary with column names as keys and expected data types as values</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Boolean indicating whether the dataframe has the same columns and types as specified in the dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== checking column names and types&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">types_dict_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

            <span class="c1"># Convert the string representation to a dictionary</span>
            <span class="n">dtypes_dict</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">types_dict_str</span><span class="p">)</span>

            <span class="c1"># Convert the data type objects to string representations</span>
            <span class="n">dtypes_str_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">dtypes_str_dict</span> <span class="o">=</span> <span class="n">types_dict_str</span>

        <span class="n">COL_NAMES_TEST</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">COL_TYPES_TEST</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check if dataframe has all the columns in the dictionary</span>
        <span class="n">missing_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dtypes_str_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># Calculate missing score</span>
        <span class="n">missing_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_cols</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dtypes_str_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_cols</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;** Columns in the dataframe are not the same as in the provided dictionary&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">COL_NAMES_TEST</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Check if data types of columns in the dataframe match the expected data types in the dictionary</span>
        <span class="n">incorrect_dtypes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes_str_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
                <span class="n">incorrect_dtypes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">incorrect_dtypes</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Incorrect data types:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">actual_dtype</span><span class="p">,</span> <span class="n">expected_dtype</span> <span class="ow">in</span> <span class="n">incorrect_dtypes</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: actual dtype is </span><span class="si">{</span><span class="n">actual_dtype</span><span class="si">}</span><span class="s2">, expected dtype is </span><span class="si">{</span><span class="n">expected_dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">COL_TYPES_TEST</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">incorrect_dtypes_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">incorrect_dtypes</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dtypes_str_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">missing_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;missing_score&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing col score was lower then expected: </span><span class="si">{</span><span class="n">missing_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;missing_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">incorrect_dtypes_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;incorrect_dtypes_score&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dtypes score was lower then expected: </span><span class="si">{</span><span class="n">incorrect_dtypes_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;incorrect_dtypes_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while checking column names and types&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">COL_NAMES_TEST</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">COL_TYPES_TEST</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">missing_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">incorrect_dtypes_score</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">COL_NAMES_TEST</span><span class="p">,</span> <span class="n">COL_TYPES_TEST</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ccnt_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;missing_score&#39;</span> <span class="p">:</span> <span class="n">missing_score</span><span class="p">,</span>
                                              <span class="s1">&#39;incorrect_dtypes_score&#39;</span> <span class="p">:</span> <span class="n">incorrect_dtypes_score</span><span class="p">}},</span>
                       <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">COL_NAMES_TEST</span><span class="p">,</span> <span class="n">COL_TYPES_TEST</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">output_dict</span></div>

<div class="viewcode-block" id="check_numeric_range"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_numeric_range">[docs]</a><span class="k">def</span> <span class="nf">check_numeric_range</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                        <span class="n">numeric_cols</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">lower_bound</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                        <span class="n">upper_bound</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                        <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">ignore_values</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
                        <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;low_numeric_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                             <span class="s1">&#39;upper_numeric_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                        <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if numeric values are in expected ranges</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">        The DataFrame to check for numeric values.</span>
<span class="sd">    lower_bound : float, optional</span>
<span class="sd">        The lower bound allowed for numeric values. Defaults to -infinity.</span>
<span class="sd">    upper_bound : float, optional</span>
<span class="sd">        The upper bound allowed for numeric values. Defaults to infinity.</span>
<span class="sd">    independent : bool, optional</span>
<span class="sd">        Whether to check the range of each column independently or not. Defaults to True.</span>
<span class="sd">    ignore_values : list, optional</span>
<span class="sd">        A list of values to ignore when checking for values outside the specified range. Defaults to empty list.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool or tuple</span>
<span class="sd">        Returns True if all numeric values in the DataFrame are within the specified range, False otherwise.</span>
<span class="sd">        If `independent` is False, returns a tuple of two bools, the first indicating</span>
<span class="sd">            if all lower bounds are met and the second if all upper bounds are met.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking expected numeric range&quot;</span><span class="p">)</span>

        <span class="n">LOW_NUMERIC_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">HIGH_NUMERIC_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">LOW_NUMERIC_SCORES_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
        <span class="n">HIGH_NUMERIC_SCORES_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
            <span class="c1"># Select only numeric columns</span>
            <span class="k">if</span> <span class="n">numeric_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>

        <span class="c1"># Check if all values in each numeric column are within range</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="c1">#outside_lower_bound = (dataframe[col] &lt; lower_bound).sum()</span>
            <span class="c1">#outside_upper_bound = (dataframe[col] &gt; upper_bound).sum()</span>

            <span class="n">outside_lower_bound</span> <span class="o">=</span> <span class="p">((</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ignore_values</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">outside_upper_bound</span> <span class="o">=</span> <span class="p">((</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ignore_values</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>


            <span class="c1"># Check if all values in the column are &gt; lower_bound</span>
            <span class="k">if</span> <span class="n">outside_lower_bound</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">min_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ignore_values</span><span class="p">))</span>

                <span class="n">min_values_n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">min_values</span><span class="p">)</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">min_values</span><span class="p">])</span>

                <span class="n">low_numeric_score</span> <span class="o">=</span> <span class="n">min_values_n</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;** Not all values in </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> are higher than </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: unexpected low values : </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">low_numeric_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>


                <span class="n">LOW_NUMERIC_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">LOW_NUMERIC_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">low_numeric_score</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>

                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with numeric values being lower the acceptable lower bound before proceesing any further!&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOW_NUMERIC_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">LOW_NUMERIC_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

            <span class="c1"># Check if all values in the column are &lt; upper_bound</span>
            <span class="k">if</span> <span class="n">outside_upper_bound</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ignore_values</span><span class="p">))</span>

                <span class="n">max_values_n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">max_values</span><span class="p">)</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">max_values</span><span class="p">])</span>

                <span class="n">upper_numeric_score</span> <span class="o">=</span> <span class="n">max_values_n</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;** Not all values in </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> are lower than </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">: unexpected high values : </span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">upper_numeric_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>

                <span class="n">HIGH_NUMERIC_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">HIGH_NUMERIC_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">upper_numeric_score</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>

                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with numeric values exceeding upper bound before proceesing any further!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">HIGH_NUMERIC_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">HIGH_NUMERIC_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>


        <span class="n">low_numeric_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">LOW_NUMERIC_SCORES_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">upper_numeric_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">HIGH_NUMERIC_SCORES_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">low_numeric_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;low_numeric_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lower numeric score was lower then expected: </span><span class="si">{</span><span class="n">low_numeric_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;low_numeric_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">upper_numeric_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;upper_numeric_score&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Upper numeric score was lower then expected: </span><span class="si">{</span><span class="n">upper_numeric_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;upper_numeric_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occurred while checking numeric ranges!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">LOW_NUMERIC_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">HIGH_NUMERIC_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

        <span class="n">low_numeric_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">upper_numeric_score</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="nb">all</span><span class="p">(</span><span class="n">LOW_NUMERIC_TEST_LIST</span><span class="p">),</span> <span class="nb">all</span><span class="p">(</span><span class="n">HIGH_NUMERIC_TEST_LIST</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cnr_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;low_numeric_score&#39;</span> <span class="p">:</span> <span class="n">low_numeric_score</span><span class="p">,</span>
                                                <span class="s1">&#39;upper_numeric_score&#39;</span> <span class="p">:</span> <span class="n">upper_numeric_score</span><span class="p">}},</span>
                       <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">all</span><span class="p">(</span><span class="n">LOW_NUMERIC_TEST_LIST</span><span class="p">),</span> <span class="nb">all</span><span class="p">(</span><span class="n">HIGH_NUMERIC_TEST_LIST</span><span class="p">)]}</span>

        <span class="k">return</span> <span class="n">output_dict</span></div>


<div class="viewcode-block" id="check_date_range"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_date_range">[docs]</a><span class="k">def</span> <span class="nf">check_date_range</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                     <span class="n">earliest_date</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-08-25&quot;</span><span class="p">,</span>
                     <span class="n">latest_date</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2100-01-01&quot;</span><span class="p">,</span>
                     <span class="n">independent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="n">silent</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">ignore_dates</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
                     <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;early_dates_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                          <span class="s1">&#39;future_dates_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                    <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if dates are in expected ranges</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">        The DataFrame to check for dates.</span>
<span class="sd">    earliest_date : str, optional</span>
<span class="sd">        The earliest date allowed in the DataFrame. Defaults to &#39;1900-08-25&#39;.</span>
<span class="sd">    latest_date : str, optional</span>
<span class="sd">        The latest date allowed in the DataFrame. Defaults to &#39;2100-01-01&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    None</span>
<span class="sd">        This function does not return anything, but logs warning messages if any dates are outside</span>
<span class="sd">        the specified range.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">independent</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">silent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking expected date range&quot;</span><span class="p">)</span>

        <span class="n">ANCIENT_DATE_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">FUTURE_DATE_TEST_LIST</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">ANCIENT_DATE_SCORES_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
        <span class="n">FUTURE_DATE_SCORES_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span>



        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>

            <span class="n">ignore_mask</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ignore_dates</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="n">earliest_date</span><span class="p">):</span>
                <span class="n">early_dates</span> <span class="o">=</span> <span class="p">((</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">earliest_date</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ignore_mask</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">early_dates</span> <span class="o">=</span> <span class="p">((</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">earliest_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ignore_mask</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="n">latest_date</span><span class="p">):</span>
                <span class="n">future_dates</span> <span class="o">=</span> <span class="p">((</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">latest_date</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ignore_mask</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">future_dates</span> <span class="o">=</span> <span class="p">((</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">latest_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">ignore_mask</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># Check if all dates are later than earliest_date</span>
            <span class="k">if</span> <span class="n">early_dates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">early_dates_score</span> <span class="o">=</span> <span class="n">early_dates</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;** Not all dates in </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> are later than </span><span class="si">{</span><span class="n">earliest_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> : ancient date : </span><span class="si">{</span><span class="n">early_dates</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">early_dates_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                <span class="n">ANCIENT_DATE_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ANCIENT_DATE_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">early_dates_score</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with ancient dates before proceesing any further!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ANCIENT_DATE_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ANCIENT_DATE_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

            <span class="c1"># Check if all dates are not later than latest_date</span>
            <span class="k">if</span> <span class="n">future_dates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">future_dates_score</span> <span class="o">=</span> <span class="n">future_dates</span><span class="o">/</span><span class="n">dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;** Not all dates in </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> are later than </span><span class="si">{</span><span class="n">latest_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> : future date : </span><span class="si">{</span><span class="n">future_dates</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">future_dates_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

                <span class="n">FUTURE_DATE_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">FUTURE_DATE_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">future_dates_score</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with future dates before proceesing any further!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FUTURE_DATE_TEST_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">FUTURE_DATE_SCORES_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">early_dates_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ANCIENT_DATE_SCORES_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">future_dates_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">FUTURE_DATE_SCORES_LIST</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">early_dates_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;early_dates_score&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Early dates score was lower then expected: </span><span class="si">{</span><span class="n">early_dates_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;early_dates_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">future_dates_score</span> <span class="o">&lt;</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;future_dates_score&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Future dates score was lower then expected: </span><span class="si">{</span><span class="n">future_dates_score</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;future_dates_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issues before proceesing any further!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while checking date ranges!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">ANCIENT_DATE_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
        <span class="n">FUTURE_DATE_TEST_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

        <span class="n">early_dates_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">future_dates_score</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">if</span> <span class="n">independent</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="nb">all</span><span class="p">(</span><span class="n">ANCIENT_DATE_TEST_LIST</span><span class="p">),</span> <span class="nb">all</span><span class="p">(</span><span class="n">FUTURE_DATE_TEST_LIST</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cdr_scores&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;early_dates_score&#39;</span> <span class="p">:</span> <span class="n">early_dates_score</span><span class="p">,</span>
                                                 <span class="s1">&#39;future_dates_score&#39;</span> <span class="p">:</span> <span class="n">future_dates_score</span><span class="p">}},</span>
                       <span class="s1">&#39;checks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">all</span><span class="p">(</span><span class="n">ANCIENT_DATE_TEST_LIST</span><span class="p">),</span> <span class="nb">all</span><span class="p">(</span><span class="n">FUTURE_DATE_TEST_LIST</span><span class="p">)]}</span>

        <span class="k">return</span> <span class="n">output_dict</span></div>

<div class="viewcode-block" id="check_duplicate_col_names"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.check_duplicate_col_names">[docs]</a><span class="k">def</span> <span class="nf">check_duplicate_col_names</span><span class="p">(</span><span class="n">dataframe</span>  <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                              <span class="n">throw_error</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                              <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check for duplicate column names in a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">        The DataFrame to check for duplicate column names.</span>
<span class="sd">    throw_error : bool, optional</span>
<span class="sd">        If True, raise a ValueError when duplicate column names are found.</span>
<span class="sd">        If False, print a warning message and continue execution.</span>
<span class="sd">        Default is False.</span>
<span class="sd">    logger : logging.Logger, optional</span>
<span class="sd">        The logger object to use for logging warning and error messages.</span>
<span class="sd">        Default is the root logger.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing information about the duplicates.</span>
<span class="sd">        &#39;column_name_freq&#39;: dict</span>
<span class="sd">            A dictionary where keys are duplicate column names, and values are the number of occurrences.</span>
<span class="sd">        &#39;COLUMN_NAMES_DUPLICATES_TEST&#39;: bool</span>
<span class="sd">            True if duplicate column names are found, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">dataframe_u_columns</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="n">column_name_freq</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">unique</span><span class="p">()}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataframe_u_columns</span><span class="p">):</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;There are duplicate column names&quot;</span><span class="p">)</span>

            <span class="p">[</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> : duplicate column names : </span><span class="si">{</span><span class="n">n_dup</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">n_dup</span> <span class="ow">in</span> <span class="n">column_name_freq</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

            <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>

                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolve issue with duplicate column names before proceesing any further!&quot;</span><span class="p">)</span>


            <span class="n">COLUMN_NAMES_DUPLICATES_TEST</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">COLUMN_NAMES_DUPLICATES_TEST</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">column_name_freq</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while checking duplicates!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="n">column_name_freq</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">COLUMN_NAMES_DUPLICATES_TEST</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;column_name_freq&#39;</span> <span class="p">:</span> <span class="n">column_name_freq</span><span class="p">,</span>
            <span class="s1">&#39;COLUMN_NAMES_DUPLICATES_TEST&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">COLUMN_NAMES_DUPLICATES_TEST</span><span class="p">]}</span></div>


<div class="viewcode-block" id="add_index_to_duplicate_columns"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.add_index_to_duplicate_columns">[docs]</a><span class="k">def</span> <span class="nf">add_index_to_duplicate_columns</span><span class="p">(</span><span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                   <span class="n">column_name_freq</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
                                  <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds an index to duplicate column names in a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe : pandas DataFrame</span>
<span class="sd">        The DataFrame containing the duplicate columns.</span>
<span class="sd">    column_name_freq : dict</span>
<span class="sd">        A dictionary where keys are duplicate column names, and values are the number of occurrences.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    pandas DataFrame</span>
<span class="sd">        The DataFrame with updated column names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">new_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">column_name_freq</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_(</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_columns</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Indexes added to duplicated column names!&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured while adding index to duplicated column names!&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>


    <span class="k">return</span> <span class="n">dataframe</span></div>


<div class="viewcode-block" id="detect_unexpected_values"><a class="viewcode-back" href="../../refineryframe.html#refineryframe.detect_unexpected.detect_unexpected_values">[docs]</a><span class="k">def</span> <span class="nf">detect_unexpected_values</span><span class="p">(</span><span class="n">dataframe</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                             <span class="n">MISSING_TYPES</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date_not_delivered&#39;</span><span class="p">:</span> <span class="s1">&#39;1850-01-09&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;numeric_not_delivered&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">999</span><span class="p">,</span>
                                                    <span class="s1">&#39;character_not_delivered&#39;</span><span class="p">:</span> <span class="s1">&#39;missing&#39;</span><span class="p">},</span>
                             <span class="n">unexpected_exceptions</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;col_names_types&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;missing_values&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;missing_types&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;inf_values&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;date_format&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;duplicates&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;date_range&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;numeric_range&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">},</span>
                             <span class="n">unexpected_exceptions_error</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;col_name_duplicates&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                   <span class="s2">&quot;col_names_types&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;missing_values&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;missing_types&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;inf_values&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;date_format&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;duplicates&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;date_range&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="s2">&quot;numeric_range&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                             <span class="n">unexpected_conditions</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">thresholds</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmt_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;numeric_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                  <span class="s1">&#39;date_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                  <span class="s1">&#39;cat_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;cmv_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;missing_values_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;ccnt_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;missing_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                   <span class="s1">&#39;incorrect_dtypes_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;inf_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;inf_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;cdf_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;date_format_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;dup_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;row_dup_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                  <span class="s1">&#39;key_dup_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;cnr_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;low_numeric_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                  <span class="s1">&#39;upper_numeric_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
                                                  <span class="s1">&#39;cdr_scores&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;early_dates_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                                                  <span class="s1">&#39;future_dates_score&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">}},</span>
                             <span class="n">ids_for_dedup</span> <span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">TEST_DUV_FLAGS_PATH</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">types_dict_str</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                             <span class="n">expected_date_format</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">earliest_date</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1900-08-25&quot;</span><span class="p">,</span>
                             <span class="n">latest_date</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2100-01-01&quot;</span><span class="p">,</span>
                             <span class="n">numeric_lower_bound</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="n">numeric_upper_bound</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
                             <span class="n">print_score</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">logger</span> <span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect unexpected values in a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    dataframe (pandas DataFrame): The DataFrame to be checked.</span>
<span class="sd">    MISSING_TYPES (dict): Dictionary that maps column names to the values considered as missing</span>
<span class="sd">                         for that column.</span>
<span class="sd">    unexpected_exceptions (dict): Dictionary that lists column exceptions for each of the</span>
<span class="sd">                                 following checks: col_names_types, missing_values, missing_types,</span>
<span class="sd">                                 inf_values, date_format, duplicates, date_range, and numeric_range.</span>
<span class="sd">    unexpected_exceptions_error (dict): Dictionary indicating whether to throw errors for each type of unexpected exception.</span>
<span class="sd">    unexpected_conditions (dict): Dictionary containing additional conditions to check for unexpected values.</span>
<span class="sd">    thresholds (dict): Dictionary containing threshold scores for different checks.</span>
<span class="sd">    ids_for_dedup (list): List of columns to identify duplicates (default is None).</span>
<span class="sd">    TEST_DUV_FLAGS_PATH (str): Path for checking unexpected values (default is None).</span>
<span class="sd">    types_dict_str (str): String that describes the expected types of the columns (default is None).</span>
<span class="sd">    expected_date_format (str): The expected date format (default is &#39;%Y-%m-%d&#39;).</span>
<span class="sd">    earliest_date (str): The earliest acceptable date (default is &quot;1900-08-25&quot;).</span>
<span class="sd">    latest_date (str): The latest acceptable date (default is &quot;2100-01-01&quot;).</span>
<span class="sd">    numeric_lower_bound (float): The lowest acceptable value for numeric columns (default is 0).</span>
<span class="sd">    numeric_upper_bound (float): The highest acceptable value for numeric columns (default is infinity).</span>
<span class="sd">    print_score (bool): Whether to print the duv score (default is True).</span>
<span class="sd">    logger (logging.Logger): Logger object for logging messages (default is logging).</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    duv_score (float): Number between 0 and 1 representing the percentage of passed tests.</span>
<span class="sd">    check_scores (dict): Scores for each check.</span>
<span class="sd">    unexpected_exceptions_scaned (dict): Unexpected exceptions based on detected unexpected values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create a logger if not provided</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Checks for duv score</span>
        <span class="n">checks_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check scores dict</span>
        <span class="n">check_score_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Check of column names are not duplicated</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking for column name duplicates&quot;</span><span class="p">)</span>

        <span class="n">cdcn_obj</span> <span class="o">=</span> <span class="n">check_duplicate_col_names</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">,</span>
                                                    <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;col_name_duplicates&#39;</span><span class="p">],</span>
                                                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

        <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cdcn_obj</span><span class="p">[</span><span class="s1">&#39;COLUMN_NAMES_DUPLICATES_TEST&#39;</span><span class="p">])</span>



        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">add_index_to_duplicate_columns</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">,</span>
                                                        <span class="n">column_name_freq</span> <span class="o">=</span> <span class="n">cdcn_obj</span><span class="p">[</span><span class="s1">&#39;column_name_freq&#39;</span><span class="p">],</span>
                                                        <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

        <span class="c1"># Separate column names by major types</span>

        <span class="n">column_types</span> <span class="o">=</span> <span class="n">get_type_dict</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span>
                                     <span class="n">explicit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                     <span class="n">stringout</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">all_columns</span> <span class="o">=</span> <span class="n">column_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

        <span class="n">index_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_columns</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;index&#39;</span><span class="p">]</span>
        <span class="n">category_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_columns</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;category&#39;</span><span class="p">]</span>
        <span class="n">date_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_columns</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="n">numeric_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_columns</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;numeric&#39;</span><span class="p">]</span>

        <span class="n">all_columns</span> <span class="o">=</span> <span class="n">index_cols</span> <span class="o">+</span> <span class="n">category_cols</span> <span class="o">+</span> <span class="n">date_cols</span> <span class="o">+</span> <span class="n">numeric_cols</span>

        <span class="c1"># Limit columns based on exceptions</span>

        <span class="n">cols_check_missing_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_columns</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;missing_types&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_missing_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_columns</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;missing_values&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_duplicates</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_columns</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_col_names_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_columns</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;col_names_types&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_date_format</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">date_cols</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;date_format&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_date_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">date_cols</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;date_range&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_inf_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numeric_cols</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;inf_values&quot;</span><span class="p">]]</span>
        <span class="n">cols_check_numeric_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numeric_cols</span>
                                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;numeric_range&quot;</span><span class="p">]]</span>


        <span class="c1"># Check if all columns are exceptions</span>

        <span class="n">run_check_missing_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;missing_types&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_missing_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_missing_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;missing_values&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_missing_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_duplicates</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_duplicates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_col_names_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;col_names_types&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> \
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">types_dict_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> \
                <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_col_names_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_date_format</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;date_format&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_date_format</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_date_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;date_range&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_date_range</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_inf_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;inf_values&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_inf_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_check_numeric_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;numeric_range&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_numeric_range</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">run_silent_check_missing_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;missing_types&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_missing_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_missing_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;missing_values&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_missing_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_duplicates</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_duplicates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_col_names_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;col_names_types&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> \
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">types_dict_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> \
                <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_col_names_types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_date_format</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;date_format&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_date_format</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_date_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;date_range&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_date_range</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_inf_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;inf_values&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_inf_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">run_silent_check_numeric_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">unexpected_exceptions</span><span class="p">[</span><span class="s2">&quot;numeric_range&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;IGNORE&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols_check_numeric_range</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unexpected_conditions</span><span class="p">:</span>
            <span class="n">run_check_additional_cons</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">unexpected_conditions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;warning&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unexpected_conditions</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">run_check_additional_cons</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">if</span> <span class="p">((</span><span class="n">ids_for_dedup</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ids_for_dedup</span> <span class="o">==</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)):</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">index_cols</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
                <span class="n">ids_for_dedup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">index_cols</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ids_for_dedup</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>


        <span class="c1"># Checks scan</span>
        <span class="n">unexpected_exceptions_scaned</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;col_names_types&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;missing_values&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;missing_types&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inf_values&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date_format&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;duplicates&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date_range&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;numeric_range&quot;</span><span class="p">:</span> <span class="s2">&quot;NONE&quot;</span>
        <span class="p">}</span>

        <span class="c1">##</span>
        <span class="k">if</span> <span class="n">run_silent_check_col_names_types</span><span class="p">:</span>

            <span class="n">ccnt_obj</span> <span class="o">=</span> <span class="n">check_col_names_types</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_col_names_types</span><span class="p">],</span>
                                                       <span class="n">types_dict_str</span> <span class="o">=</span> <span class="n">types_dict_str</span><span class="p">,</span>
                                                       <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_col_names_types</span><span class="p">,</span>
                                                       <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;col_names_types&#39;</span><span class="p">],</span>
                                                       <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ccnt_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">run_check_col_names_types</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ccnt_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;col_names_types&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="c1">##</span>
        <span class="k">if</span> <span class="n">run_silent_check_missing_values</span><span class="p">:</span>

            <span class="n">cmv_obj</span> <span class="o">=</span> <span class="n">check_missing_values</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_missing_values</span><span class="p">],</span>
                                                     <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_missing_values</span><span class="p">,</span>
                                                     <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;missing_values&#39;</span><span class="p">],</span>
                                                     <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cmv_scores&#39;</span><span class="p">],</span>
                                                     <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmv_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_missing_values</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cmv_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;missing_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="c1">##</span>
        <span class="k">if</span> <span class="n">run_silent_check_missing_types</span><span class="p">:</span>

            <span class="n">cmt_obj</span> <span class="o">=</span> <span class="n">check_missing_types</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_missing_types</span><span class="p">],</span>
                                                    <span class="n">MISSING_TYPES</span> <span class="o">=</span> <span class="n">MISSING_TYPES</span><span class="p">,</span>
                                                    <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_missing_types</span><span class="p">,</span>
                                                    <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;missing_types&#39;</span><span class="p">],</span>
                                                    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cmt_scores&#39;</span><span class="p">],</span>
                                                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cmt_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_missing_types</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cmt_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;missing_types&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="c1">##</span>

        <span class="k">if</span> <span class="n">run_silent_check_date_format</span><span class="p">:</span>

            <span class="n">cdf_obj</span> <span class="o">=</span> <span class="n">check_date_format</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_date_format</span><span class="p">],</span>
                                                  <span class="n">expected_date_format</span> <span class="o">=</span> <span class="n">expected_date_format</span><span class="p">,</span>
                                                  <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_date_format</span><span class="p">,</span>
                                                  <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;date_format&#39;</span><span class="p">],</span>
                                                  <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cdf_scores&#39;</span><span class="p">],</span>
                                                  <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cdf_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_date_format</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cdf_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;date_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>

        <span class="c1">##</span>

        <span class="k">if</span> <span class="n">run_silent_check_date_range</span><span class="p">:</span>

            <span class="n">cdr_obj</span> <span class="o">=</span> <span class="n">check_date_range</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_date_range</span><span class="p">],</span>
                                                 <span class="n">earliest_date</span> <span class="o">=</span> <span class="n">earliest_date</span><span class="p">,</span>
                                                 <span class="n">latest_date</span> <span class="o">=</span> <span class="n">latest_date</span><span class="p">,</span>
                                                 <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                 <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_date_range</span><span class="p">,</span>
                                                 <span class="n">ignore_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MISSING_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                                                 <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;date_&quot;</span><span class="p">)],</span>
                                                 <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;date_range&#39;</span><span class="p">],</span>
                                                 <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cdr_scores&#39;</span><span class="p">],</span>
                                                 <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cdr_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_date_range</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cdr_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;date_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="c1">##</span>

        <span class="k">if</span> <span class="n">run_silent_check_duplicates</span><span class="p">:</span>

            <span class="n">dup_obj</span> <span class="o">=</span> <span class="n">check_duplicates</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_duplicates</span><span class="p">],</span>
                                                <span class="n">subset</span> <span class="o">=</span> <span class="n">ids_for_dedup</span><span class="p">,</span>
                                                <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_duplicates</span><span class="p">,</span>
                                                <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;duplicates&#39;</span><span class="p">],</span>
                                                <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;dup_scores&#39;</span><span class="p">],</span>
                                                <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dup_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_duplicates</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dup_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>
        <span class="c1">##</span>

        <span class="k">if</span> <span class="n">run_silent_check_inf_values</span><span class="p">:</span>

            <span class="n">inf_obj</span> <span class="o">=</span> <span class="n">check_inf_values</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_inf_values</span><span class="p">],</span>
                                       <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                       <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_inf_values</span><span class="p">,</span>
                                       <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;inf_values&#39;</span><span class="p">],</span>
                                       <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;inf_scores&#39;</span><span class="p">],</span>
                                       <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">inf_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_inf_values</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inf_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;inf_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>

        <span class="c1">##</span>

        <span class="k">if</span> <span class="n">run_silent_check_numeric_range</span><span class="p">:</span>

            <span class="n">cnr_obj</span> <span class="o">=</span> <span class="n">check_numeric_range</span><span class="p">(</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">cols_check_numeric_range</span><span class="p">],</span>
                                                    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">numeric_lower_bound</span><span class="p">,</span>
                                                    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">numeric_upper_bound</span><span class="p">,</span>
                                                    <span class="n">independent</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                    <span class="n">silent</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">run_check_numeric_range</span><span class="p">,</span>
                                                    <span class="n">ignore_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">MISSING_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                                                     <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;numeric_&quot;</span><span class="p">)],</span>
                                                    <span class="n">throw_error</span> <span class="o">=</span> <span class="n">unexpected_exceptions_error</span><span class="p">[</span><span class="s1">&#39;numeric_range&#39;</span><span class="p">],</span>
                                                    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="s1">&#39;cnr_scores&#39;</span><span class="p">],</span>
                                                    <span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">)</span>

            <span class="n">check_score_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cnr_obj</span><span class="p">[</span><span class="s1">&#39;scores&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">run_check_numeric_range</span><span class="p">:</span>

            <span class="n">checks_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cnr_obj</span><span class="p">[</span><span class="s1">&#39;checks&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checks_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">unexpected_exceptions_scaned</span><span class="p">[</span><span class="s2">&quot;numeric_range&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span>

        <span class="c1">##</span>

        <span class="k">if</span> <span class="n">run_check_additional_cons</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== checking additional cons&quot;</span><span class="p">)</span>

            <span class="n">conds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unexpected_conditions</span> <span class="k">if</span> <span class="n">unexpected_conditions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;warning&#39;</span><span class="p">]]</span>

            <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conds</span><span class="p">:</span>

                <span class="n">unexpected_condition</span> <span class="o">=</span> <span class="n">unexpected_conditions</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span>

                <span class="n">treat_unexpected_cond</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">,</span>
                                      <span class="n">description</span> <span class="o">=</span> <span class="n">unexpected_condition</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                                      <span class="n">group</span> <span class="o">=</span> <span class="n">unexpected_condition</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span>
                                      <span class="n">features</span> <span class="o">=</span> <span class="n">unexpected_condition</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">],</span>
                                      <span class="n">query</span> <span class="o">=</span> <span class="n">unexpected_condition</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">],</span>
                                      <span class="n">warning</span> <span class="o">=</span> <span class="n">unexpected_condition</span><span class="p">[</span><span class="s1">&#39;warning&#39;</span><span class="p">],</span>
                                      <span class="n">replace</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                      <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>



        <span class="n">duv_score</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">checks_list</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">checks_list</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_score</span> <span class="ow">and</span> <span class="n">duv_score</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percentage of passed tests: </span><span class="si">{</span><span class="p">(</span><span class="n">duv_score</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">TEST_DUV_FLAGS_PATH</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">TEST_DUV_FLAGS_PATH</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">duv_score</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;duv_score&#39;</span> <span class="p">:</span> <span class="n">duv_score</span><span class="p">,</span>
                    <span class="s1">&#39;check_scores&#39;</span> <span class="p">:</span> <span class="n">check_score_dict</span><span class="p">,</span>
                    <span class="s1">&#39;unexpected_exceptions_scaned&#39;</span> <span class="p">:</span> <span class="n">unexpected_exceptions_scaned</span><span class="p">}</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error occured during duv score calculation!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Kyrylo Mordan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>